function getPasteEvent(){var e=document.createElement("input"),t="onpaste";return e.setAttribute(t,""),"function"==typeof e[t]?"paste":"input"}var caretTimeoutId,pasteEventName=getPasteEvent()+".mask",ua=navigator.userAgent,iPhone=/iphone/i.test(ua),android=/android/i.test(ua);$.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},$.fn.extend({caret:function(e,t){var n;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&((n=this.createTextRange()).collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(t,h){var n,m,p,v,g;return!t&&0<this.length?$(this[0]).data($.mask.dataName)():(h=$.extend({placeholder:$.mask.placeholder,completed:null},h),n=$.mask.definitions,m=[],p=g=t.length,v=null,$.each(t.split(""),function(e,t){"?"==t?(g--,p=e):n[t]?(m.push(new RegExp(n[t])),null===v&&(v=m.length-1)):m.push(null)}),this.trigger("unmask").each(function(){var o=$(this),c=$.map(t.split(""),function(e,t){if("?"!=e)return n[e]?h.placeholder:e}),i=o.val();function l(e){for(;++e<g&&!m[e];);return e}function s(e,t){var n,a;if(!(e<0)){for(n=e,a=l(t);n<g;n++)if(m[n]){if(!(a<g&&m[n].test(c[a])))break;c[n]=c[a],c[a]=h.placeholder,a=l(a)}d(),o.caret(Math.max(v,e))}}function u(e,t){var n;for(n=e;n<t&&n<g;n++)m[n]&&(c[n]=h.placeholder)}function d(){o.val(c.join(""))}function f(e){var t,n,a=o.val(),r=-1;for(t=0,pos=0;t<g;t++)if(m[t]){for(c[t]=h.placeholder;pos++<a.length;)if(n=a.charAt(pos-1),m[t].test(n)){c[t]=n,r=t;break}if(pos>a.length)break}else c[t]===a.charAt(pos)&&t!==p&&(pos++,r=t);return e?d():r+1<p?(o.val(""),u(0,g)):(d(),o.val(o.val().substring(0,r+1))),p?t:v}o.data($.mask.dataName,function(){return $.map(c,function(e,t){return m[t]&&e!=h.placeholder?e:null}).join("")}),o.attr("readonly")||o.one("unmask",function(){o.unbind(".mask").removeData($.mask.dataName)}).bind("focus.mask",function(){var e;clearTimeout(caretTimeoutId),i=o.val(),e=f(),caretTimeoutId=setTimeout(function(){d(),e==t.length?o.caret(0,e):o.caret(e)},10)}).bind("blur.mask",function(){f(),o.val()!=i&&o.change()}).bind("keydown.mask",function(e){var t,n,a,r=e.which;8===r||46===r||iPhone&&127===r?(n=(t=o.caret()).begin,(a=t.end)-n==0&&(n=46!==r?function(e){for(;0<=--e&&!m[e];);return e}(n):a=l(n-1),a=46===r?l(a):a),u(n,a),s(n,a-1),e.preventDefault()):27==r&&(o.val(i),o.caret(0,f()),e.preventDefault())}).bind("keypress.mask",function(e){var t,n,a,r=e.which,i=o.caret();e.ctrlKey||e.altKey||e.metaKey||r<32||r&&(i.end-i.begin!=0&&(u(i.begin,i.end),s(i.begin,i.end-1)),(t=l(i.begin-1))<g&&(n=String.fromCharCode(r),m[t].test(n)&&(function(e){var t,n,a,r;for(t=e,n=h.placeholder;t<g;t++)if(m[t]){if(a=l(t),r=c[t],c[t]=n,!(a<g&&m[a].test(r)))break;n=r}}(t),c[t]=n,d(),a=l(t),android?setTimeout($.proxy($.fn.caret,o,a),0):o.caret(a),h.completed&&g<=a&&h.completed.call(o))),e.preventDefault())}).bind(pasteEventName,function(){setTimeout(function(){var e=f(!0);o.caret(e),h.completed&&e==o.val().length&&h.completed.call(o)},0)}),f()}))}});